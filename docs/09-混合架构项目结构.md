# Java + Python 混合架构项目结构

## 完整目录树

```
IntelliKnowledge-RAG/
│
├── java-services/                                  # Java微服务根目录
│   ├── pom.xml                                     # 父POM（聚合所有Java模块）
│   │
│   ├── common/                                     # 公共模块
│   │   ├── src/main/java/com/intelliknowledge/common/
│   │   │   ├── response/
│   │   │   │   ├── Result.java                    # 统一响应格式
│   │   │   │   ├── PageResponse.java              # 分页响应
│   │   │   │   └── ErrorCode.java                 # 错误码枚举
│   │   │   ├── exception/
│   │   │   │   ├── BusinessException.java         # 业务异常
│   │   │   │   ├── SystemException.java           # 系统异常
│   │   │   │   └── GlobalExceptionHandler.java    # 全局异常处理器
│   │   │   ├── util/
│   │   │   │   ├── JsonUtil.java                  # JSON工具
│   │   │   │   ├── DateUtil.java                  # 日期工具
│   │   │   │   ├── EncryptUtil.java               # 加密工具
│   │   │   │   └── StringUtil.java                # 字符串工具
│   │   │   ├── annotation/
│   │   │   │   ├── RequirePermission.java         # 权限注解
│   │   │   │   ├── RateLimited.java               # 限流注解
│   │   │   │   └── AuditLog.java                  # 审计日志注解
│   │   │   └── constant/
│   │   │       ├── CommonConstant.java            # 通用常量
│   │   │       └── CacheConstant.java             # 缓存常量
│   │   └── pom.xml
│   │
│   ├── gateway-service/                            # API网关服务
│   │   ├── src/
│   │   │   └── main/
│   │   │       ├── java/com/intelliknowledge/gateway/
│   │   │       │   ├── GatewayApplication.java    # 启动类
│   │   │       │   ├── config/
│   │   │       │   │   ├── GatewayConfig.java     # 网关配置
│   │   │       │   │   ├── CorsConfig.java        # 跨域配置
│   │   │       │   │   ├── RedisRateLimiterConfig.java  # 限流配置
│   │   │       │   │   └── NacosConfig.java       # Nacos配置
│   │   │       │   ├── filter/
│   │   │       │   │   ├── GlobalJwtAuthFilter.java     # JWT认证过滤器
│   │   │       │   │   ├── RequestLogFilter.java        # 请求日志过滤器
│   │   │       │   │   ├── ResponseCacheFilter.java     # 响应缓存过滤器
│   │   │       │   │   └── RequestRateLimiterFilter.java # 限流过滤器
│   │   │       │   ├── handler/
│   │   │       │   │   └── GlobalExceptionHandler.java  # 全局异常处理
│   │   │       │   └── util/
│   │   │       │       └── JwtUtil.java           # JWT工具类
│   │   │       └── resources/
│   │   │           ├── application.yml            # 主配置文件
│   │   │           ├── application-dev.yml        # 开发环境配置
│   │   │           ├── application-test.yml       # 测试环境配置
│   │   │           ├── application-prod.yml       # 生产环境配置
│   │   │           └── bootstrap.yml              # Nacos配置
│   │   ├── pom.xml
│   │   └── Dockerfile
│   │
│   ├── user-service/                               # 用户服务
│   │   ├── src/
│   │   │   ├── main/
│   │   │   │   ├── java/com/intelliknowledge/user/
│   │   │   │   │   ├── UserServiceApplication.java      # 启动类
│   │   │   │   │   │
│   │   │   │   │   ├── controller/
│   │   │   │   │   │   ├── AuthController.java          # 认证接口
│   │   │   │   │   │   ├── UserController.java          # 用户管理接口
│   │   │   │   │   │   ├── RoleController.java          # 角色管理接口
│   │   │   │   │   │   └── PermissionController.java    # 权限管理接口
│   │   │   │   │   │
│   │   │   │   │   ├── service/
│   │   │   │   │   │   ├── UserService.java             # 用户业务逻辑
│   │   │   │   │   │   ├── UserServiceImpl.java
│   │   │   │   │   │   ├── AuthService.java             # 认证业务逻辑
│   │   │   │   │   │   ├── AuthServiceImpl.java
│   │   │   │   │   │   ├── RoleService.java             # 角色业务逻辑
│   │   │   │   │   │   └── PermissionService.java       # 权限业务逻辑
│   │   │   │   │   │
│   │   │   │   │   ├── mapper/                          # MyBatis Mapper接口
│   │   │   │   │   │   ├── UserMapper.java
│   │   │   │   │   │   ├── RoleMapper.java
│   │   │   │   │   │   ├── PermissionMapper.java
│   │   │   │   │   │   └── UserRoleMapper.java
│   │   │   │   │   │
│   │   │   │   │   ├── entity/
│   │   │   │   │   │   ├── User.java                    # 用户实体
│   │   │   │   │   │   ├── Role.java                    # 角色实体
│   │   │   │   │   │   ├── Permission.java              # 权限实体
│   │   │   │   │   │   └── UserRole.java                # 用户角色关联
│   │   │   │   │   │
│   │   │   │   │   ├── dto/
│   │   │   │   │   │   ├── request/
│   │   │   │   │   │   │   ├── RegisterRequest.java     # 注册请求
│   │   │   │   │   │   │   ├── LoginRequest.java        # 登录请求
│   │   │   │   │   │   │   ├── UpdateUserRequest.java   # 更新用户请求
│   │   │   │   │   │   │   ├── ResetPasswordRequest.java # 重置密码请求
│   │   │   │   │   │   │   └── AssignRoleRequest.java   # 分配角色请求
│   │   │   │   │   │   └── response/
│   │   │   │   │   │       ├── LoginResponse.java       # 登录响应
│   │   │   │   │   │       ├── UserDTO.java             # 用户DTO
│   │   │   │   │   │       ├── RoleDTO.java             # 角色DTO
│   │   │   │   │   │       └── UserDetailResponse.java  # 用户详情响应
│   │   │   │   │   │
│   │   │   │   │   ├── security/
│   │   │   │   │   │   ├── JwtTokenProvider.java        # JWT生成和验证
│   │   │   │   │   │   ├── SecurityConfig.java          # Spring Security配置
│   │   │   │   │   │   ├── UserDetailsServiceImpl.java  # 用户详情服务
│   │   │   │   │   │   ├── JwtAuthenticationFilter.java # JWT认证过滤器
│   │   │   │   │   │   └── PasswordEncoder.java         # 密码加密
│   │   │   │   │   │
│   │   │   │   │   ├── config/
│   │   │   │   │   │   ├── MyBatisConfig.java           # MyBatis配置
│   │   │   │   │   │   ├── RedisConfig.java             # Redis配置
│   │   │   │   │   │   └── SwaggerConfig.java           # Swagger配置
│   │   │   │   │   │
│   │   │   │   │   └── exception/
│   │   │   │   │       ├── UserNotFoundException.java
│   │   │   │   │       ├── InvalidCredentialsException.java
│   │   │   │   │       ├── DuplicateUserException.java
│   │   │   │   │       └── PermissionDeniedException.java
│   │   │   │   │
│   │   │   │   └── resources/
│   │   │   │       ├── application.yml
│   │   │   │       ├── application-dev.yml
│   │   │   │       ├── application-prod.yml
│   │   │   │       ├── bootstrap.yml
│   │   │   │       ├── mapper/                          # MyBatis XML映射文件
│   │   │   │       │   ├── UserMapper.xml
│   │   │   │       │   ├── RoleMapper.xml
│   │   │   │       │   └── PermissionMapper.xml
│   │   │   │       └── db/migration/                    # Flyway数据库迁移
│   │   │   │           ├── V1__create_users_table.sql
│   │   │   │           ├── V2__create_roles_table.sql
│   │   │   │           ├── V3__create_permissions_table.sql
│   │   │   │           └── V4__create_user_roles_table.sql
│   │   │   │
│   │   │   └── test/
│   │   │       └── java/com/intelliknowledge/user/
│   │   │           ├── controller/
│   │   │           │   └── AuthControllerTest.java
│   │   │           ├── service/
│   │   │           │   └── UserServiceTest.java
│   │   │           └── mapper/
│   │   │               └── UserMapperTest.java
│   │   ├── pom.xml
│   │   └── Dockerfile
│   │
│   ├── collection-service/                         # 知识库服务
│   │   ├── src/
│   │   │   ├── main/
│   │   │   │   ├── java/com/intelliknowledge/collection/
│   │   │   │   │   ├── CollectionServiceApplication.java
│   │   │   │   │   │
│   │   │   │   │   ├── controller/
│   │   │   │   │   │   ├── CollectionController.java    # 知识库CRUD
│   │   │   │   │   │   ├── PermissionController.java    # 知识库权限管理
│   │   │   │   │   │   └── MemberController.java        # 成员管理
│   │   │   │   │   │
│   │   │   │   │   ├── service/
│   │   │   │   │   │   ├── CollectionService.java
│   │   │   │   │   │   ├── CollectionServiceImpl.java
│   │   │   │   │   │   ├── PermissionService.java
│   │   │   │   │   │   └── MemberService.java
│   │   │   │   │   │
│   │   │   │   │   ├── mapper/
│   │   │   │   │   │   ├── CollectionMapper.java
│   │   │   │   │   │   ├── CollectionPermissionMapper.java
│   │   │   │   │   │   └── CollectionMemberMapper.java
│   │   │   │   │   │
│   │   │   │   │   ├── entity/
│   │   │   │   │   │   ├── Collection.java              # 知识库实体
│   │   │   │   │   │   ├── CollectionPermission.java    # 知识库权限
│   │   │   │   │   │   └── CollectionMember.java        # 知识库成员
│   │   │   │   │   │
│   │   │   │   │   ├── dto/
│   │   │   │   │   │   ├── request/
│   │   │   │   │   │   │   ├── CreateCollectionRequest.java
│   │   │   │   │   │   │   ├── UpdateCollectionRequest.java
│   │   │   │   │   │   │   ├── InviteMemberRequest.java
│   │   │   │   │   │   │   └── UpdatePermissionRequest.java
│   │   │   │   │   │   └── response/
│   │   │   │   │   │       ├── CollectionDTO.java
│   │   │   │   │   │       ├── CollectionDetailDTO.java
│   │   │   │   │   │       └── MemberDTO.java
│   │   │   │   │   │
│   │   │   │   │   ├── aspect/
│   │   │   │   │   │   ├── PermissionCheckAspect.java   # 权限检查切面
│   │   │   │   │   │   └── AuditLogAspect.java          # 审计日志切面
│   │   │   │   │   │
│   │   │   │   │   ├── enums/
│   │   │   │   │   │   ├── PermissionType.java          # 权限类型枚举
│   │   │   │   │   │   └── MemberRole.java              # 成员角色枚举
│   │   │   │   │   │
│   │   │   │   │   └── config/
│   │   │   │   │       ├── MyBatisConfig.java
│   │   │   │   │       └── RedisConfig.java
│   │   │   │   │
│   │   │   │   └── resources/
│   │   │   │       ├── application.yml
│   │   │   │       ├── mapper/
│   │   │   │       │   ├── CollectionMapper.xml
│   │   │   │       │   └── CollectionPermissionMapper.xml
│   │   │   │       └── db/migration/
│   │   │   │           ├── V1__create_collections_table.sql
│   │   │   │           └── V2__create_collection_permissions_table.sql
│   │   │   │
│   │   │   └── test/
│   │   ├── pom.xml
│   │   └── Dockerfile
│   │
│   ├── document-service/                           # 文档管理服务
│   │   ├── src/
│   │   │   ├── main/
│   │   │   │   ├── java/com/intelliknowledge/document/
│   │   │   │   │   ├── DocumentServiceApplication.java
│   │   │   │   │   │
│   │   │   │   │   ├── controller/
│   │   │   │   │   │   ├── DocumentController.java      # 文档CRUD
│   │   │   │   │   │   ├── ChunkController.java         # 文档块查询
│   │   │   │   │   │   └── UploadController.java        # 文件上传
│   │   │   │   │   │
│   │   │   │   │   ├── service/
│   │   │   │   │   │   ├── DocumentService.java
│   │   │   │   │   │   ├── DocumentServiceImpl.java
│   │   │   │   │   │   ├── FileStorageService.java      # 文件存储服务（MinIO）
│   │   │   │   │   │   ├── ChunkService.java            # 文档块服务
│   │   │   │   │   │   └── DocumentEventPublisher.java  # 文档事件发布
│   │   │   │   │   │
│   │   │   │   │   ├── feign/                           # Feign客户端（调用Python服务）
│   │   │   │   │   │   ├── IngestionServiceClient.java  # 调用文档摄入服务
│   │   │   │   │   │   └── fallback/
│   │   │   │   │   │       ├── IngestionServiceFallback.java  # 熔断降级
│   │   │   │   │   │       └── IngestionServiceFallbackFactory.java
│   │   │   │   │   │
│   │   │   │   │   ├── mapper/
│   │   │   │   │   │   ├── DocumentMapper.java
│   │   │   │   │   │   └── ChunkMapper.java
│   │   │   │   │   │
│   │   │   │   │   ├── entity/
│   │   │   │   │   │   ├── Document.java                # 文档实体
│   │   │   │   │   │   └── Chunk.java                   # 文档块实体
│   │   │   │   │   │
│   │   │   │   │   ├── dto/
│   │   │   │   │   │   ├── request/
│   │   │   │   │   │   │   ├── UploadDocumentRequest.java
│   │   │   │   │   │   │   ├── UpdateDocumentRequest.java
│   │   │   │   │   │   │   ├── QueryDocumentRequest.java
│   │   │   │   │   │   │   └── ProcessDocumentRequest.java  # 发送给Python服务
│   │   │   │   │   │   └── response/
│   │   │   │   │   │       ├── DocumentDTO.java
│   │   │   │   │   │       ├── DocumentDetailDTO.java
│   │   │   │   │   │       ├── DocumentStatusDTO.java
│   │   │   │   │   │       ├── ChunkDTO.java
│   │   │   │   │   │       └── UploadResponse.java
│   │   │   │   │   │
│   │   │   │   │   ├── mq/                              # 消息队列
│   │   │   │   │   │   ├── listener/
│   │   │   │   │   │   │   ├── DocumentProcessedListener.java  # 监听文档处理完成事件
│   │   │   │   │   │   │   └── DocumentFailedListener.java
│   │   │   │   │   │   ├── producer/
│   │   │   │   │   │   │   └── DocumentEventProducer.java      # 发布文档事件
│   │   │   │   │   │   └── event/
│   │   │   │   │   │       ├── DocumentUploadedEvent.java
│   │   │   │   │   │       ├── DocumentProcessedEvent.java
│   │   │   │   │   │       └── DocumentDeletedEvent.java
│   │   │   │   │   │
│   │   │   │   │   ├── config/
│   │   │   │   │   │   ├── MinioConfig.java             # MinIO对象存储配置
│   │   │   │   │   │   ├── FeignConfig.java             # Feign配置
│   │   │   │   │   │   ├── RabbitMQConfig.java          # RabbitMQ配置
│   │   │   │   │   │   └── MyBatisConfig.java
│   │   │   │   │   │
│   │   │   │   │   └── enums/
│   │   │   │   │       ├── DocumentStatus.java          # 文档状态枚举
│   │   │   │   │       └── FileType.java                # 文件类型枚举
│   │   │   │   │
│   │   │   │   └── resources/
│   │   │   │       ├── application.yml
│   │   │   │       ├── mapper/
│   │   │   │       │   ├── DocumentMapper.xml
│   │   │   │       │   └── ChunkMapper.xml
│   │   │   │       └── db/migration/
│   │   │   │           ├── V1__create_documents_table.sql
│   │   │   │           └── V2__create_chunks_table.sql
│   │   │   │
│   │   │   └── test/
│   │   ├── pom.xml
│   │   └── Dockerfile
│   │
│   └── audit-service/                              # 审计日志服务（可选）
│       ├── src/
│       │   ├── main/
│       │   │   ├── java/com/intelliknowledge/audit/
│       │   │   │   ├── AuditServiceApplication.java
│       │   │   │   ├── controller/
│       │   │   │   │   └── AuditLogController.java
│       │   │   │   ├── service/
│       │   │   │   │   └── AuditLogService.java
│       │   │   │   ├── mapper/
│       │   │   │   │   └── AuditLogMapper.java
│       │   │   │   ├── entity/
│       │   │   │   │   └── AuditLog.java
│       │   │   │   └── dto/
│       │   │   │       └── response/
│       │   │   │           └── AuditLogDTO.java
│       │   │   └── resources/
│       │   │       ├── application.yml
│       │   │       └── mapper/
│       │   │           └── AuditLogMapper.xml
│       │   └── test/
│       ├── pom.xml
│       └── Dockerfile
│
├── python-services/                                # Python微服务根目录
│   │
│   ├── ingestion-service/                          # 文档摄入服务
│   │   ├── app/
│   │   │   ├── __init__.py
│   │   │   ├── main.py                             # FastAPI应用入口
│   │   │   │
│   │   │   ├── api/                                # API路由
│   │   │   │   ├── __init__.py
│   │   │   │   ├── dependencies.py                 # 依赖注入
│   │   │   │   └── v1/
│   │   │   │       ├── __init__.py
│   │   │   │       ├── ingestion.py               # 文档处理接口
│   │   │   │       ├── status.py                  # 处理状态查询
│   │   │   │       └── webhook.py                 # 回调接口
│   │   │   │
│   │   │   ├── core/                               # 核心配置
│   │   │   │   ├── __init__.py
│   │   │   │   ├── config.py                      # 配置管理（使用pydantic-settings）
│   │   │   │   └── logging.py                     # 日志配置
│   │   │   │
│   │   │   ├── services/                           # 业务服务
│   │   │   │   ├── __init__.py
│   │   │   │   │
│   │   │   │   ├── parsers/                       # 文档解析器
│   │   │   │   │   ├── __init__.py
│   │   │   │   │   ├── base_parser.py            # 解析器基类
│   │   │   │   │   ├── parser_factory.py         # 解析器工厂
│   │   │   │   │   ├── pdf_parser.py             # PDF解析（PyMuPDF）
│   │   │   │   │   ├── markdown_parser.py        # Markdown解析
│   │   │   │   │   ├── docx_parser.py            # Word解析（python-docx）
│   │   │   │   │   ├── pptx_parser.py            # PPT解析（python-pptx）
│   │   │   │   │   ├── image_parser.py           # 图片OCR（PaddleOCR）
│   │   │   │   │   ├── table_parser.py           # 表格提取（Camelot）
│   │   │   │   │   └── code_parser.py            # 代码文件解析
│   │   │   │   │
│   │   │   │   ├── chunking/                      # 文档分块
│   │   │   │   │   ├── __init__.py
│   │   │   │   │   ├── base_chunker.py           # 分块器基类
│   │   │   │   │   ├── fixed_chunker.py          # 固定长度分块
│   │   │   │   │   ├── semantic_chunker.py       # 语义边界分块
│   │   │   │   │   ├── recursive_chunker.py      # 递归字符分块（LangChain）
│   │   │   │   │   └── markdown_chunker.py       # Markdown结构化分块
│   │   │   │   │
│   │   │   │   ├── embedding_service.py           # Embedding生成服务
│   │   │   │   ├── milvus_service.py              # Milvus向量存储
│   │   │   │   ├── postgres_service.py            # PostgreSQL元数据存储
│   │   │   │   ├── java_service_client.py         # 调用Java服务的客户端
│   │   │   │   ├── pipeline.py                    # 完整处理流程编排
│   │   │   │   └── content_cleaner.py             # 内容清洗
│   │   │   │
│   │   │   ├── models/                             # 数据模型
│   │   │   │   ├── __init__.py
│   │   │   │   ├── schemas.py                     # Pydantic模型
│   │   │   │   ├── document.py                    # 文档模型
│   │   │   │   └── chunk.py                       # 文档块模型
│   │   │   │
│   │   │   ├── db/                                 # 数据库连接
│   │   │   │   ├── __init__.py
│   │   │   │   ├── postgres.py                    # PostgreSQL连接
│   │   │   │   ├── milvus.py                      # Milvus连接
│   │   │   │   └── redis.py                       # Redis连接
│   │   │   │
│   │   │   ├── tasks/                              # Celery异步任务
│   │   │   │   ├── __init__.py
│   │   │   │   ├── celery_app.py                  # Celery应用配置
│   │   │   │   ├── document_tasks.py              # 文档处理任务
│   │   │   │   └── cleanup_tasks.py               # 清理任务
│   │   │   │
│   │   │   └── utils/                              # 工具函数
│   │   │       ├── __init__.py
│   │   │       ├── file_utils.py                  # 文件操作工具
│   │   │       ├── text_utils.py                  # 文本处理工具
│   │   │       ├── hash_utils.py                  # 哈希工具
│   │   │       └── monitoring.py                  # 监控工具
│   │   │
│   │   ├── tests/                                  # 测试
│   │   │   ├── __init__.py
│   │   │   ├── conftest.py                        # pytest配置
│   │   │   ├── test_parsers.py                    # 解析器测试
│   │   │   ├── test_chunking.py                   # 分块测试
│   │   │   └── test_pipeline.py                   # 流程测试
│   │   │
│   │   ├── requirements.txt                        # Python依赖
│   │   ├── requirements-dev.txt                    # 开发依赖
│   │   ├── Dockerfile
│   │   ├── .env.example                            # 环境变量示例
│   │   └── README.md
│   │
│   ├── rag-service/                                # RAG服务
│   │   ├── app/
│   │   │   ├── __init__.py
│   │   │   ├── main.py                             # FastAPI应用入口
│   │   │   │
│   │   │   ├── api/
│   │   │   │   ├── __init__.py
│   │   │   │   ├── dependencies.py
│   │   │   │   └── v1/
│   │   │   │       ├── __init__.py
│   │   │   │       ├── chat.py                    # 问答接口（流式/非流式）
│   │   │   │       ├── search.py                  # 检索接口
│   │   │   │       ├── conversation.py            # 对话管理
│   │   │   │       └── evaluation.py              # 答案评估
│   │   │   │
│   │   │   ├── core/
│   │   │   │   ├── __init__.py
│   │   │   │   ├── config.py
│   │   │   │   └── logging.py
│   │   │   │
│   │   │   ├── services/
│   │   │   │   ├── __init__.py
│   │   │   │   │
│   │   │   │   ├── retrieval/                     # 检索服务
│   │   │   │   │   ├── __init__.py
│   │   │   │   │   ├── base_retriever.py         # 检索器基类
│   │   │   │   │   ├── vector_retriever.py       # 向量检索（Milvus）
│   │   │   │   │   ├── keyword_retriever.py      # 关键词检索（BM25/Elasticsearch）
│   │   │   │   │   ├── graph_retriever.py        # 知识图谱检索（调用graph-service）
│   │   │   │   │   ├── hybrid_retriever.py       # 混合检索（RRF融合）
│   │   │   │   │   └── reranker.py               # 重排序（Cross-Encoder）
│   │   │   │   │
│   │   │   │   ├── agentic/                       # Agent工作流
│   │   │   │   │   ├── __init__.py
│   │   │   │   │   ├── workflow.py               # LangGraph工作流定义
│   │   │   │   │   ├── state.py                  # Agent状态定义
│   │   │   │   │   │
│   │   │   │   │   └── agents/                   # Agent实现
│   │   │   │   │       ├── __init__.py
│   │   │   │   │       ├── planning_agent.py     # 规划Agent（查询分解）
│   │   │   │   │       ├── retrieval_agent.py    # 检索Agent
│   │   │   │   │       ├── generation_agent.py   # 生成Agent
│   │   │   │   │       ├── reflection_agent.py   # 反思Agent（答案质量评估）
│   │   │   │   │       ├── rewriting_agent.py    # 改写Agent（查询改写）
│   │   │   │   │       └── routing_agent.py      # 路由Agent（决策下一步）
│   │   │   │   │
│   │   │   │   ├── llm/                           # LLM服务
│   │   │   │   │   ├── __init__.py
│   │   │   │   │   ├── base_client.py            # LLM客户端基类
│   │   │   │   │   ├── openai_client.py          # OpenAI客户端
│   │   │   │   │   ├── anthropic_client.py       # Anthropic Claude客户端
│   │   │   │   │   ├── local_client.py           # 本地模型客户端（Ollama）
│   │   │   │   │   └── prompt_manager.py         # Prompt模板管理
│   │   │   │   │
│   │   │   │   ├── conversation_service.py        # 对话管理服务
│   │   │   │   ├── cache_service.py               # 缓存服务（Redis）
│   │   │   │   └── monitoring_service.py          # 监控服务
│   │   │   │
│   │   │   ├── db/
│   │   │   │   ├── __init__.py
│   │   │   │   ├── postgres.py                    # PostgreSQL（对话历史）
│   │   │   │   ├── milvus.py                      # Milvus（向量检索）
│   │   │   │   ├── neo4j.py                       # Neo4j（图谱检索）
│   │   │   │   └── redis.py                       # Redis（缓存）
│   │   │   │
│   │   │   ├── models/
│   │   │   │   ├── __init__.py
│   │   │   │   ├── schemas.py                     # Pydantic模型
│   │   │   │   ├── chat.py                        # 聊天模型
│   │   │   │   └── retrieval.py                   # 检索模型
│   │   │   │
│   │   │   └── utils/
│   │   │       ├── __init__.py
│   │   │       ├── cache.py                       # 缓存工具
│   │   │       ├── token_counter.py               # Token计数
│   │   │       └── monitoring.py                  # 监控指标
│   │   │
│   │   ├── tests/
│   │   │   ├── __init__.py
│   │   │   ├── test_retrieval.py                  # 检索测试
│   │   │   ├── test_agents.py                     # Agent测试
│   │   │   └── test_workflow.py                   # 工作流测试
│   │   │
│   │   ├── requirements.txt
│   │   ├── requirements-dev.txt
│   │   ├── Dockerfile
│   │   ├── .env.example
│   │   └── README.md
│   │
│   └── graph-service/                              # 知识图谱服务
│       ├── app/
│       │   ├── __init__.py
│       │   ├── main.py                             # FastAPI应用入口
│       │   │
│       │   ├── api/
│       │   │   ├── __init__.py
│       │   │   ├── dependencies.py
│       │   │   └── v1/
│       │   │       ├── __init__.py
│       │   │       ├── entities.py                # 实体查询接口
│       │   │       ├── relations.py               # 关系查询接口
│       │   │       ├── subgraph.py                # 子图查询接口
│       │   │       └── build.py                   # 图谱构建接口
│       │   │
│       │   ├── core/
│       │   │   ├── __init__.py
│       │   │   ├── config.py
│       │   │   └── logging.py
│       │   │
│       │   ├── services/
│       │   │   ├── __init__.py
│       │   │   ├── ner_service.py                 # 命名实体识别（spaCy/GLiNER）
│       │   │   ├── relation_extraction.py         # 关系抽取（LLM-based）
│       │   │   ├── graph_builder.py               # 图谱构建服务
│       │   │   ├── graph_query_service.py         # 图谱查询服务
│       │   │   ├── community_detection.py         # 社区发现（Louvain）
│       │   │   └── centrality_analysis.py         # 中心性分析（PageRank）
│       │   │
│       │   ├── db/
│       │   │   ├── __init__.py
│       │   │   ├── neo4j_client.py                # Neo4j客户端封装
│       │   │   └── postgres.py                    # PostgreSQL（元数据）
│       │   │
│       │   ├── models/
│       │   │   ├── __init__.py
│       │   │   ├── schemas.py                     # Pydantic模型
│       │   │   ├── entity.py                      # 实体模型
│       │   │   └── relation.py                    # 关系模型
│       │   │
│       │   ├── tasks/                              # Celery任务
│       │   │   ├── __init__.py
│       │   │   ├── celery_app.py
│       │   │   └── graph_tasks.py                 # 图谱构建任务
│       │   │
│       │   └── utils/
│       │       ├── __init__.py
│       │       └── cypher_builder.py              # Cypher查询构建器
│       │
│       ├── tests/
│       │   ├── __init__.py
│       │   ├── test_ner.py
│       │   ├── test_relation_extraction.py
│       │   └── test_graph_builder.py
│       │
│       ├── requirements.txt
│       ├── requirements-dev.txt
│       ├── Dockerfile
│       ├── .env.example
│       └── README.md
│
├── frontend/                                       # 前端应用（React + TypeScript）
│   ├── public/
│   │   ├── index.html
│   │   ├── favicon.ico
│   │   └── assets/
│   │       └── images/
│   │
│   ├── src/
│   │   ├── main.tsx                                # 应用入口
│   │   ├── App.tsx                                 # 根组件
│   │   ├── vite-env.d.ts
│   │   │
│   │   ├── components/                             # 可复用组件
│   │   │   ├── layout/                             # 布局组件
│   │   │   │   ├── Header.tsx                     # 头部导航
│   │   │   │   ├── Sidebar.tsx                    # 侧边栏
│   │   │   │   ├── Footer.tsx                     # 页脚
│   │   │   │   └── Layout.tsx                     # 主布局
│   │   │   │
│   │   │   ├── document/                           # 文档相关组件
│   │   │   │   ├── DocumentUpload.tsx             # 文档上传（拖拽上传）
│   │   │   │   ├── DocumentList.tsx               # 文档列表（表格）
│   │   │   │   ├── DocumentCard.tsx               # 文档卡片
│   │   │   │   ├── DocumentViewer.tsx             # 文档预览
│   │   │   │   ├── DocumentFilter.tsx             # 文档筛选
│   │   │   │   └── UploadProgress.tsx             # 上传进度条
│   │   │   │
│   │   │   ├── chat/                               # 聊天相关组件
│   │   │   │   ├── ChatInterface.tsx              # 聊天界面
│   │   │   │   ├── MessageBubble.tsx              # 消息气泡
│   │   │   │   ├── MessageList.tsx                # 消息列表
│   │   │   │   ├── ChatInput.tsx                  # 输入框
│   │   │   │   ├── SourceCard.tsx                 # 引用来源卡片
│   │   │   │   ├── ConversationList.tsx           # 对话历史列表
│   │   │   │   ├── StreamingText.tsx              # 流式输出动画
│   │   │   │   └── ConfidenceIndicator.tsx        # 置信度指示器
│   │   │   │
│   │   │   ├── graph/                              # 知识图谱组件
│   │   │   │   ├── GraphVisualization.tsx         # 图谱可视化（D3.js）
│   │   │   │   ├── EntityCard.tsx                 # 实体卡片
│   │   │   │   ├── RelationView.tsx               # 关系视图
│   │   │   │   └── GraphControls.tsx              # 图谱控制器
│   │   │   │
│   │   │   ├── collection/                         # 知识库组件
│   │   │   │   ├── CollectionCard.tsx             # 知识库卡片
│   │   │   │   ├── CollectionList.tsx             # 知识库列表
│   │   │   │   ├── CreateCollectionModal.tsx      # 创建知识库弹窗
│   │   │   │   └── PermissionManager.tsx          # 权限管理
│   │   │   │
│   │   │   └── common/                             # 通用组件
│   │   │       ├── Button.tsx                     # 按钮
│   │   │       ├── Input.tsx                      # 输入框
│   │   │       ├── Select.tsx                     # 下拉选择
│   │   │       ├── Modal.tsx                      # 弹窗
│   │   │       ├── Loading.tsx                    # 加载动画
│   │   │       ├── Empty.tsx                      # 空状态
│   │   │       └── ErrorBoundary.tsx              # 错误边界
│   │   │
│   │   ├── pages/                                  # 页面级组件
│   │   │   ├── Login.tsx                          # 登录页
│   │   │   ├── Register.tsx                       # 注册页
│   │   │   ├── Dashboard.tsx                      # 仪表盘（概览）
│   │   │   ├── Collections.tsx                    # 知识库列表页
│   │   │   ├── CollectionDetail.tsx               # 知识库详情页
│   │   │   ├── Documents.tsx                      # 文档管理页
│   │   │   ├── Chat.tsx                           # 对话页
│   │   │   ├── Graph.tsx                          # 知识图谱页
│   │   │   ├── Settings.tsx                       # 设置页
│   │   │   ├── Profile.tsx                        # 个人中心
│   │   │   └── NotFound.tsx                       # 404页面
│   │   │
│   │   ├── hooks/                                  # 自定义Hooks
│   │   │   ├── useAuth.ts                         # 认证Hook
│   │   │   ├── useDocuments.ts                    # 文档Hook
│   │   │   ├── useCollections.ts                  # 知识库Hook
│   │   │   ├── useChat.ts                         # 聊天Hook
│   │   │   ├── useWebSocket.ts                    # WebSocket Hook
│   │   │   ├── useDebounce.ts                     # 防抖Hook
│   │   │   └── useInfiniteScroll.ts               # 无限滚动Hook
│   │   │
│   │   ├── store/                                  # 状态管理（Zustand）
│   │   │   ├── authStore.ts                       # 认证状态
│   │   │   ├── documentStore.ts                   # 文档状态
│   │   │   ├── collectionStore.ts                 # 知识库状态
│   │   │   ├── chatStore.ts                       # 聊天状态
│   │   │   └── uiStore.ts                         # UI状态（侧边栏、主题）
│   │   │
│   │   ├── api/                                    # API客户端
│   │   │   ├── client.ts                          # Axios配置（拦截器、基础URL）
│   │   │   ├── auth.ts                            # 认证API
│   │   │   ├── collections.ts                     # 知识库API
│   │   │   ├── documents.ts                       # 文档API
│   │   │   ├── chat.ts                            # 对话API
│   │   │   ├── graph.ts                           # 图谱API
│   │   │   └── users.ts                           # 用户API
│   │   │
│   │   ├── utils/                                  # 工具函数
│   │   │   ├── format.ts                          # 格式化工具
│   │   │   ├── validate.ts                        # 验证工具
│   │   │   ├── storage.ts                         # 本地存储工具
│   │   │   ├── constants.ts                       # 常量定义
│   │   │   └── helpers.ts                         # 辅助函数
│   │   │
│   │   ├── types/                                  # TypeScript类型定义
│   │   │   ├── user.ts                            # 用户类型
│   │   │   ├── document.ts                        # 文档类型
│   │   │   ├── collection.ts                      # 知识库类型
│   │   │   ├── chat.ts                            # 聊天类型
│   │   │   ├── graph.ts                           # 图谱类型
│   │   │   └── api.ts                             # API响应类型
│   │   │
│   │   ├── styles/                                 # 样式文件
│   │   │   ├── global.css                         # 全局样式
│   │   │   ├── variables.css                      # CSS变量
│   │   │   └── themes.css                         # 主题样式
│   │   │
│   │   └── router/                                 # 路由配置
│   │       ├── index.tsx                          # 路由定义
│   │       └── PrivateRoute.tsx                   # 私有路由（需要登录）
│   │
│   ├── package.json
│   ├── package-lock.json
│   ├── tsconfig.json                               # TypeScript配置
│   ├── tsconfig.node.json
│   ├── vite.config.ts                              # Vite配置
│   ├── .eslintrc.cjs                               # ESLint配置
│   ├── .prettierrc                                 # Prettier配置
│   ├── Dockerfile
│   ├── .env.example
│   └── README.md
│
├── deployment/                                     # 部署配置
│   ├── docker-compose.yml                          # 开发环境（Docker Compose）
│   ├── docker-compose.prod.yml                     # 生产环境
│   │
│   ├── kubernetes/                                 # Kubernetes配置
│   │   ├── namespace.yaml                         # 命名空间
│   │   ├── configmap.yaml                         # 配置映射
│   │   ├── secrets.yaml                           # 密钥
│   │   │
│   │   ├── java-services/                         # Java服务部署
│   │   │   ├── gateway-deployment.yaml
│   │   │   ├── gateway-service.yaml
│   │   │   ├── gateway-hpa.yaml                   # 水平自动扩缩容
│   │   │   ├── user-deployment.yaml
│   │   │   ├── user-service.yaml
│   │   │   ├── collection-deployment.yaml
│   │   │   ├── collection-service.yaml
│   │   │   ├── document-deployment.yaml
│   │   │   └── document-service.yaml
│   │   │
│   │   ├── python-services/                       # Python服务部署
│   │   │   ├── ingestion-deployment.yaml
│   │   │   ├── ingestion-service.yaml
│   │   │   ├── ingestion-hpa.yaml
│   │   │   ├── rag-deployment.yaml
│   │   │   ├── rag-service.yaml
│   │   │   ├── rag-hpa.yaml
│   │   │   ├── graph-deployment.yaml
│   │   │   └── graph-service.yaml
│   │   │
│   │   ├── infrastructure/                        # 基础设施
│   │   │   ├── postgres-statefulset.yaml         # PostgreSQL有状态集
│   │   │   ├── postgres-service.yaml
│   │   │   ├── postgres-pvc.yaml                 # 持久卷声明
│   │   │   ├── redis-deployment.yaml
│   │   │   ├── redis-service.yaml
│   │   │   ├── milvus-deployment.yaml
│   │   │   ├── milvus-service.yaml
│   │   │   ├── neo4j-statefulset.yaml
│   │   │   ├── neo4j-service.yaml
│   │   │   ├── rabbitmq-deployment.yaml
│   │   │   ├── rabbitmq-service.yaml
│   │   │   ├── nacos-deployment.yaml
│   │   │   └── nacos-service.yaml
│   │   │
│   │   ├── frontend/                              # 前端部署
│   │   │   ├── frontend-deployment.yaml
│   │   │   └── frontend-service.yaml
│   │   │
│   │   └── ingress.yaml                           # Ingress配置（外部访问）
│   │
│   └── nginx/                                      # Nginx配置
│       ├── nginx.conf                             # Nginx主配置
│       └── conf.d/
│           └── default.conf                       # 虚拟主机配置
│
├── monitoring/                                     # 监控配置
│   ├── prometheus/                                 # Prometheus配置
│   │   ├── prometheus.yml                         # Prometheus主配置
│   │   ├── rules/                                 # 告警规则
│   │   │   ├── java-services.yml                 # Java服务告警
│   │   │   ├── python-services.yml               # Python服务告警
│   │   │   └── infrastructure.yml                # 基础设施告警
│   │   └── targets/                               # 抓取目标
│   │       └── service-discovery.yml
│   │
│   ├── grafana/                                    # Grafana配置
│   │   ├── dashboards/                            # 仪表盘
│   │   │   ├── system-overview.json              # 系统概览
│   │   │   ├── java-services.json                # Java服务监控
│   │   │   ├── python-services.json              # Python服务监控
│   │   │   ├── database.json                     # 数据库监控
│   │   │   └── business-metrics.json             # 业务指标
│   │   └── provisioning/                          # 自动配置
│   │       ├── datasources.yml                   # 数据源配置
│   │       └── dashboards.yml                    # 仪表盘配置
│   │
│   └── elk/                                        # ELK Stack配置
│       ├── logstash/
│       │   ├── logstash.conf                     # Logstash配置
│       │   └── pipelines/                        # Pipeline配置
│       │       ├── java-logs.conf
│       │       └── python-logs.conf
│       ├── elasticsearch/
│       │   └── elasticsearch.yml
│       └── kibana/
│           ├── kibana.yml
│           └── dashboards/                        # Kibana仪表盘
│
├── scripts/                                        # 脚本工具
│   ├── init-db.sh                                 # 初始化数据库
│   ├── start-dev.sh                               # 启动开发环境
│   ├── stop-dev.sh                                # 停止开发环境
│   ├── build-all.sh                               # 构建所有服务
│   ├── build-java.sh                              # 构建Java服务
│   ├── build-python.sh                            # 构建Python服务
│   ├── deploy-k8s.sh                              # K8s部署脚本
│   ├── backup.sh                                  # 数据备份
│   ├── restore.sh                                 # 数据恢复
│   ├── wait-for-services.sh                       # 等待服务就绪
│   └── cleanup.sh                                 # 清理环境
│
├── docs/                                           # 文档
│   ├── 01-产品需求文档PRD.md
│   ├── 02-技术架构设计.md
│   ├── 03-API接口设计文档.md
│   ├── 04-数据库设计文档.md
│   ├── 05-开发计划与里程碑.md
│   ├── 06-项目结构说明.md
│   ├── 07-技术选型与对比.md
│   ├── 08-Java混合架构方案.md
│   └── 09-混合架构项目结构.md
│
├── .github/                                        # GitHub配置
│   ├── workflows/                                 # GitHub Actions
│   │   ├── java-services-ci.yml                  # Java服务CI
│   │   ├── python-services-ci.yml                # Python服务CI
│   │   ├── frontend-ci.yml                       # 前端CI
│   │   ├── deploy-dev.yml                        # 部署到开发环境
│   │   ├── deploy-prod.yml                       # 部署到生产环境
│   │   └── release.yml                           # 发布流程
│   └── ISSUE_TEMPLATE/                            # Issue模板
│       ├── bug_report.md
│       └── feature_request.md
│
├── .gitignore                                      # Git忽略文件
├── .editorconfig                                   # 编辑器配置
├── README.md                                       # 项目说明
├── 项目总览.md                                       # 项目总览
├── LICENSE                                         # 开源协议
└── CHANGELOG.md                                    # 变更日志
```

---

## 关键目录说明

### Java微服务（java-services/）
- **common/**: 所有Java服务共享的公共代码
- **gateway-service/**: API网关，统一入口
- **user-service/**: 用户认证、权限管理
- **collection-service/**: 知识库管理
- **document-service/**: 文档元数据管理，调用Python服务

### Python微服务（python-services/）
- **ingestion-service/**: 文档解析、分块、向量化
- **rag-service/**: Agentic RAG核心，LangGraph工作流
- **graph-service/**: 知识图谱构建与查询

### 前端（frontend/）
- **components/**: 可复用组件（布局、文档、聊天、图谱）
- **pages/**: 页面级组件
- **hooks/**: 自定义Hooks
- **store/**: Zustand状态管理
- **api/**: API客户端封装

### 部署（deployment/）
- **docker-compose.yml**: 开发环境一键启动
- **kubernetes/**: 生产环境K8s配置

### 监控（monitoring/）
- **prometheus/**: 指标收集
- **grafana/**: 可视化监控
- **elk/**: 日志收集分析

---

**文档版本**：v1.0
**最后更新**：2025-12-04
**作者**：Jerry
